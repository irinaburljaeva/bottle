<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Островное меню</title>

<link rel="preload" as="image" href="bottle2.jpg">
<style>
  :root{
    --size: 420px;           /* размер бутылки */
    --hover-scale: 1.05;
    --page-bg: #ffffff;      /* однотонный белый */
  }

  body{
    margin:0;
    min-height:100vh;
    display:grid;
    place-items:center;
    background: var(--page-bg);
    color:#222;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
  }

  /* Контейнер для bottle + конфетти */
  .stage{
    position: relative;
    display: grid;
    place-items: center;
    padding: 24px;
  }

  /* Кнопка-бутылка (минимализм, без рамок) */
  .bottle{
    position:relative;
    display:block;
    width:var(--size);
    aspect-ratio:1/1.35;
    background:transparent;
    border:0;
    cursor:pointer;
    outline:none;
    -webkit-tap-highlight-color: transparent;

    /* лёгкая глубина */
    filter: drop-shadow(0 10px 22px rgba(0,0,0,.18));
    transform-style: preserve-3d;            /* для tilt-эффекта */
    transform-origin: 50% 80%;
    transition: transform .18s ease;
  }

  .bottle:hover,
  .bottle:focus-visible,
  .bottle.active{ transform: scale(var(--hover-scale)) }

  /* Изображения и смена состояний */
  .bottle img{
    position:absolute; inset:0;
    width:100%; height:100%;
    object-fit:contain;
    user-select:none; pointer-events:none;
    transition: opacity .18s ease;
    backface-visibility: hidden;
  }
  .img-active{ opacity:0 }
  .bottle:hover .img-active,
  .bottle:focus-visible .img-active,
  .bottle.active .img-active{ opacity:1 }
  .bottle:hover .img-default,
  .bottle:focus-visible .img-default,
  .bottle.active .img-default{ opacity:0 }

  /* Едва заметный «солнечный блик» по стеклу */
  .bottle::before{
    content:"";
    position:absolute; inset:-6% -6%;
    background:
      linear-gradient(75deg, rgba(255,255,255,0) 40%, rgba(255,255,255,.6) 50%, rgba(255,255,255,0) 60%);
    transform: translateX(-130%) rotate(0.001deg);
    mix-blend-mode: screen;
    pointer-events:none;
    opacity:0;
  }
  .bottle.shine::before{ opacity:1; animation: shine 1.2s ease forwards }
  @keyframes shine{
    0%   { transform: translateX(-130%) }
    100% { transform: translateX(130%) }
  }

  /* Мягкий «спотлайт» вокруг (очень деликатный) */
  .stage::after{
    content:"";
    position:absolute; width:56vmin; height:56vmin;
    background: radial-gradient(circle, rgba(0,0,0,.06), rgba(0,0,0,0) 60%);
    filter: blur(12px);
    z-index:-1;
    opacity:.6;
    transition: opacity .25s ease, transform .25s ease;
  }
  .bottle:hover ~ .hint + .spot, /* страховка, не используется */
  .stage:hover::after{ opacity:.75; transform: scale(1.03) }

  /* Подпись */
  .hint{
    margin-top:16px;
    text-align:center;
    font-size:14px;
    color:#444;
    opacity:.85;
  }

  /* Клавиатурный фокус */
  .bottle:focus-visible{
    box-shadow: 0 0 0 4px rgba(30, 144, 255, .25);
    border-radius: 20px;
  }

  /* Canvas для конфетти поверх бутылки */
  #confetti{
    position:absolute;
    inset:0;
    pointer-events:none;
  }

  /* Reduce motion: отключаем shine/tilt/confetti-анимации */
  @media (prefers-reduced-motion: reduce){
    .bottle, .bottle img{ transition:none }
    .bottle::before{ display:none }
    #confetti{ display:none }
  }

  /* Адаптив */
  @media (max-width: 520px){
    :root{ --size: 78vw }
  }
</style>
</head>
<body>

  <div class="stage" aria-live="polite">
    <button class="bottle"
            aria-label="Открыть меню"
            data-pdf="menu.pdf">
      <img class="img-default" src="menu.png" alt="Бутылка с посланием">
      <img class="img-active"  src="bottle2.jpg" alt="" aria-hidden="true">
    </button>
    <canvas id="confetti" width="1" height="1"></canvas>
    <div class="hint">Нажмите на бутылку — и меню скачается</div>
  </div>

  <!-- Скрытая ссылка для скачивания -->
  <a id="dl" href="menu.pdf" download hidden>скачать меню</a>

<script>
  (function(){
    const bottle   = document.querySelector('.bottle');
    const stage    = document.querySelector('.stage');
    const dl       = document.getElementById('dl');
    const canvas   = document.getElementById('confetti');
    const ctx      = canvas.getContext('2d', {alpha: true});

    // Resize canvas to match stage
    function sizeCanvas(){
      const rect = stage.getBoundingClientRect();
      canvas.width  = Math.max(1, Math.floor(rect.width));
      canvas.height = Math.max(1, Math.floor(rect.height));
    }
    sizeCanvas();
    window.addEventListener('resize', sizeCanvas);

    // 1) Shine sweep (редко сам запускается)
    let shineTimer = setInterval(()=> {
      if (document.hidden) return;
      bottle.classList.add('shine');
      setTimeout(()=> bottle.classList.remove('shine'), 1300);
    }, 7000); // каждые ~7с лёгкий блик

    // Также запускаем блик на ховер
    bottle.addEventListener('mouseenter', ()=>{
      bottle.classList.add('shine');
      setTimeout(()=> bottle.classList.remove('shine'), 1300);
    });

    // 2) Лёгкий 3D tilt (мышью)
    const maxTilt = 6; // градусов
    stage.addEventListener('mousemove', (e)=>{
      const r = bottle.getBoundingClientRect();
      const x = (e.clientX - r.left) / r.width;   // 0..1
      const y = (e.clientY - r.top)  / r.height;  // 0..1
      const rx = (0.5 - y) * maxTilt;             // X-ось
      const ry = (x - 0.5) * maxTilt;             // Y-ось
      bottle.style.transform =
        `scale(var(--hover-scale)) rotateX(${rx}deg) rotateY(${ry}deg)`;
    });
    stage.addEventListener('mouseleave', ()=>{
      bottle.style.transform = '';
    });

    // 3) Конфетти-взрыв при клике + скачивание PDF
    bottle.addEventListener('click', () => {
      // Короткая активация
      bottle.classList.add('active');
      setTimeout(() => bottle.classList.remove('active'), 220);

      // Haptic (если доступно)
      if (navigator.vibrate) { try { navigator.vibrate(25); } catch(_){} }

      // Конфетти
      burstConfetti();

      // Скачать PDF
      const pdf = bottle.dataset.pdf || 'menu.pdf';
      dl.href = pdf;
      dl.setAttribute('download', pdf.split('/').pop() || 'menu.pdf');
      dl.click();
    });

    // Тач-подсветка
    bottle.addEventListener('touchstart', () => bottle.classList.add('active'), {passive:true});
    bottle.addEventListener('touchend',   () => bottle.classList.remove('active'));

    // ==== Конфетти-реализация ====
    function burstConfetti(){
      sizeCanvas();
      const W = canvas.width, H = canvas.height;

      // Параметры конфетти
      const N = Math.min(120, Math.floor(W * 0.22)); // количество от размера
      const particles = [];
      const cx = W/2, cy = H/2 - 10; // центр около бутылки

      for (let i=0;i<N;i++){
        const angle = (Math.random()*Math.PI*2);
        const speed = 3 + Math.random()*5;
        particles.push({
          x: cx, y: cy,
          vx: Math.cos(angle)*speed,
          vy: Math.sin(angle)*speed - (2+Math.random()*2),
          g: 0.12 + Math.random()*0.12,
          size: 2 + Math.random()*4,
          rot: Math.random()*Math.PI,
          vr: (Math.random()-0.5)*0.25,
          alpha: 1,
          shape: (Math.random()<0.6) ? 'rect' : 'circle',
          color: pickColor(i)
        });
      }

      let start = performance.now();
      function frame(t){
        const dt = Math.min(32, t - start); // ms
        start = t;

        ctx.clearRect(0,0,W,H);

        let alive = 0;
        for (const p of particles){
          p.vy += p.g;
          p.x  += p.vx;
          p.y  += p.vy;
          p.rot+= p.vr;
          p.alpha *= 0.985; // затухание

          if (p.alpha > 0.05 && p.y < H+20){
            alive++;
            ctx.save();
            ctx.globalAlpha = p.alpha;
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rot);
            ctx.fillStyle = p.color;
            if (p.shape === 'rect'){
              ctx.fillRect(-p.size, -p.size*0.5, p.size*2, p.size);
            } else {
              ctx.beginPath();
              ctx.arc(0,0,p.size,0,Math.PI*2);
              ctx.fill();
            }
            ctx.restore();
          }
        }

        if (alive>0){
          requestAnimationFrame(frame);
        } else {
          ctx.clearRect(0,0,W,H);
        }
      }
      requestAnimationFrame(frame);
    }

    function pickColor(i){
      // Немного «островной» палитры, но без навязчивости
      const palette = ['#00a8e8','#ffd166','#06d6a0','#ef476f','#118ab2'];
      return palette[i % palette.length];
    }

    // Чистка shine-интервала при уходе со страницы
    window.addEventListener('pagehide', ()=> clearInterval(shineTimer));
  })();
</script>
</body>
</html>
